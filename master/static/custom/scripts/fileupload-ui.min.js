function testcase_info(){var a=($("#table_upload_file").find("tr").length-1,$("td .samename_testcase").length);globalProgressNode=$("#fileupload").find(".fileupload-progress"),extendedProgressNode=globalProgressNode.find(".progress-extended"),a>0&&($("#fileupload").find(".fileupload-progress").addClass("in"),extendedProgressNode.html('<font face="verdana" color="red">该产品线下存在  '+a+"  个文件内容不一致的同名测试用例</font>"))}function success_count(){var a=$("#table_upload_file").find("tr").length-1,b=0;for(var c in jQuery.Device_Flash_Fireware_Global_Args.GLOBAL_IS_FILE_UPLOAD_SUCCESS)jQuery.Device_Flash_Fireware_Global_Args.GLOBAL_IS_FILE_UPLOAD_SUCCESS[c]===!0&&(b+=1);var d=($("#fileupload"),Math.floor(b/a*100)),e=$("#fileupload").find(".fileupload-progress"),f=e.find(".progress-extended");a>0&&$("#fileupload").find(".fileupload-progress").addClass("in"),f.html("已上传"+b.toString()+"个文件，还剩"+(a-b).toString()+"个文件"),d>=100?e.find(".progress").removeClass("active"):e.find(".progress").addClass("active"),e.find(".progress").attr("aria-valuenow",d).children().first().css("width",d+"%")}!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery","tmpl","./jquery.fileupload-image","./jquery.fileupload-audio","./jquery.fileupload-video","./jquery.fileupload-validate"],a):"object"==typeof exports?a(require("jquery"),require("tmpl")):a(window.jQuery,window.tmpl)}(function(a,b){"use strict";a.blueimp.fileupload.prototype._specialOptions.push("filesContainer","uploadTemplateId","downloadTemplateId"),a.widget("blueimp.fileupload",a.blueimp.fileupload,{options:{autoUpload:!1,uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:void 0,prependFiles:!1,dataType:"json",messages:{unknownError:"Unknown error"},getNumberOfFiles:function(){return this.filesContainer.children().not(".processing").length},getFilesFromResponse:function(b){return b.result&&a.isArray(b.result.files)?b.result.files:[]},add:function(b,c){if(b.isDefaultPrevented())return!1;var d=a(this),e=d.data("blueimp-fileupload")||d.data("fileupload"),f=e.options;c.context=e._renderUpload(c.files).data("data",c).addClass("processing"),f.filesContainer[f.prependFiles?"prepend":"append"](c.context),e._forceReflow(c.context),e._transition(c.context),c.process(function(){return d.fileupload("process",c)}).always(function(){c.context.each(function(b){a(this).find(".size").text(e._formatFileSize(c.files[b].size))}).removeClass("processing"),e._renderPreviews(c)}).done(function(){c.context.find(".start").prop("disabled",!1),e._trigger("added",b,c)!==!1&&(f.autoUpload||c.autoUpload)&&c.autoUpload!==!1&&c.submit()}).fail(function(){c.files.error&&c.context.each(function(b){var d=c.files[b].error;d&&a(this).find(".error").text(d)})})},send:function(b,c){if(b.isDefaultPrevented())return!1;var d=a(this).data("blueimp-fileupload")||a(this).data("fileupload");return c.context&&c.dataType&&"iframe"===c.dataType.substr(0,6),d._trigger("sent",b,c)},done:function(b,c){if(b.isDefaultPrevented())return!1;var d=a("#current_user_id").text(),e=d;a.ajax({type:"post",url:"/setUserRightInUploadTestCase?product_id="+e+"&current_user_id="+d+"&uploadtest_status=0",error:function(a){hiAlert("系统错误，未恢复该产品上传状态")},success:function(a){}});var f,g,h=a(this).data("blueimp-fileupload")||a(this).data("fileupload"),i=c.getFilesFromResponse||h.options.getFilesFromResponse,j=i(c);c.context?c.context.each(function(d){var e=j[d]||{error:"Empty file upload result"};e.index=c.files[0].index,e.webkitRelativePath=c.files[0].webkitRelativePath,jQuery.Device_Flash_Fireware_Global_Args.GLOBAL_IS_FILE_UPLOAD_SUCCESS[e.webkitRelativePath]=!0,g=h._addFinishedDeferreds(),h._transition(a(this)).done(function(){var d=a(this);f=h._renderDownload([e]).replaceAll(d),h._forceReflow(f),h._transition(f).done(function(){c.context=a(this),h._trigger("completed",b,c),h._trigger("finished",b,c),g.resolve()})})}):(f=h._renderDownload(j)[h.options.prependFiles?"prependTo":"appendTo"](h.options.filesContainer),h._forceReflow(f),g=h._addFinishedDeferreds(),h._transition(f).done(function(){c.context=a(this),h._trigger("completed",b,c),h._trigger("finished",b,c),g.resolve()}))},fail:function(b,c){if(b.isDefaultPrevented())return!1;if(void 0!==c.files&&void 0!==c.paramName&&"True"==c.files[0].start){if(b.isDefaultPrevented())return!1;var d,e,f=a(this).data("blueimp-fileupload")||a(this).data("fileupload"),g=c.getFilesFromResponse||f.options.getFilesFromResponse,h=g(c);c.context?c.context.each(function(g){if(jQuery.Device_Flash_Fireware_Global_Args.GLOBAL_IS_FILE_UPLOAD_SUCCESS[c.files[0].webkitRelativePath]===!0)var h={status:"上传成功",name:c.files[0].name,size:c.files[0].size,index:c.files[0].index};else{var h={name:c.files[0].name,size:c.files[0].size,index:c.files[0].index},i=a("#current_user_id").text(),j=i;a.ajax({type:"post",url:"/setUserRightInUploadTestCase?product_id="+j+"&current_user_id="+i+"&uploadtest_status=0",error:function(a){hiAlert("系统错误，未恢复该产品上传状态")},success:function(a){}})}if(void 0===h.index)for(var k=0;k<c.originalFiles.length;k++)h.name==c.originalFiles[k].name&&(h.index=k+1);e=f._addFinishedDeferreds(),f._transition(a(this)).done(function(){var g=a(this);d=f._renderDownload([h]).replaceAll(g),f._forceReflow(d),f._transition(d).done(function(){c.context=a(this),f._trigger("completed",b,c),f._trigger("finished",b,c),e.resolve()})})}):(d=f._renderDownload(h)[f.options.prependFiles?"prependTo":"appendTo"](f.options.filesContainer),f._forceReflow(d),e=f._addFinishedDeferreds(),f._transition(d).done(function(){c.context=a(this),f._trigger("completed",b,c),f._trigger("finished",b,c),e.resolve()}))}a("#fileupload").find(".fileupload-progress").removeClass("in"),a("#fileupload").find(".progress").attr("aria-valuenow","0").children().first().css("width","0%"),a("#fileupload").find(".progress-extended").html("");var d,e,f=a(this).data("blueimp-fileupload")||a(this).data("fileupload");c.context?c.context.each(function(g){if("abort"!==c.errorThrown){var h=c.files[g];h.error=h.error||c.errorThrown||c.i18n("unknownError"),e=f._addFinishedDeferreds(),f._transition(a(this)).done(function(){var g=a(this);d=f._renderDownload([h]).replaceAll(g),f._forceReflow(d),f._transition(d).done(function(){c.context=a(this),f._trigger("failed",b,c),f._trigger("finished",b,c),e.resolve()})})}else e=f._addFinishedDeferreds(),f._transition(a(this)).done(function(){a(this).remove(),f._trigger("failed",b,c),f._trigger("finished",b,c),e.resolve()})}):"abort"!==c.errorThrown?(c.context=f._renderUpload(c.files)[f.options.prependFiles?"prependTo":"appendTo"](f.options.filesContainer).data("data",c),f._forceReflow(c.context),e=f._addFinishedDeferreds(),f._transition(c.context).done(function(){c.context=a(this),f._trigger("failed",b,c),f._trigger("finished",b,c),e.resolve()})):(f._trigger("failed",b,c),f._trigger("finished",b,c),f._addFinishedDeferreds().resolve())},progress:function(b,c){if(b.isDefaultPrevented())return!1;a("#fileupload").find(".fileupload-progress").addClass("in");var d=Math.floor(c.loaded/c.total*100);c.context?c.context.each(function(){a(this).find(".progress").attr("aria-valuenow",d).children().first().css("width",d+"%")}):0!=c.loaded&&c.context.each(function(){a(this).find(".progress").attr("aria-valuenow",0).children().first().css("width",d+"%")})},progressall:function(a,b){if(a.isDefaultPrevented())return!1},start:function(b){if(b.isDefaultPrevented())return!1;var c=a(this).data("blueimp-fileupload")||a(this).data("fileupload");c._resetFinishedDeferreds(),c._transition(a(this).find(".fileupload-progress")).done(function(){c._trigger("started",b)})},stop:function(b){if(b.isDefaultPrevented())return!1;var c=a(this).data("blueimp-fileupload")||a(this).data("fileupload"),d=c._addFinishedDeferreds();setTimeout(function(){var e=a("#table_upload_file").find("tr").length-1,f=a("td .success_upload_count").length;a.when.apply(a,c._getFinishedDeferreds()).done(function(){c._trigger("stopped",b)}),c._transition(a(this).find(".fileupload-progress")).done(function(){a(this).find(".progress").attr("aria-valuenow","100").children().first().css("width","100%"),a(this).find(".progress-extended").html("已上传"+f.toString()+"个文件，还剩"+(e-f).toString()+"个文件"),d.resolve()})},1e3)},processstart:function(b){return!b.isDefaultPrevented()&&void a(this).addClass("fileupload-processing")},processstop:function(b){return!b.isDefaultPrevented()&&void a(this).removeClass("fileupload-processing")},destroy:function(b,c){if(b.isDefaultPrevented())return!1;var d=a(this).data("blueimp-fileupload")||a(this).data("fileupload"),e=function(){d._transition(c.context).done(function(){a(this).remove(),d._trigger("destroyed",b,c)})};c.url?(c.dataType=c.dataType||d.options.dataType,a.ajax(c).done(e).fail(function(){d._trigger("destroyfailed",b,c)})):e()}},_resetFinishedDeferreds:function(){this._finishedUploads=[]},_addFinishedDeferreds:function(b){return b||(b=a.Deferred()),this._finishedUploads.push(b),b},_getFinishedDeferreds:function(){return this._finishedUploads},_enableDragToDesktop:function(){var b=a(this),c=b.prop("href"),d=b.prop("download"),e="application/octet-stream";b.bind("dragstart",function(a){try{a.originalEvent.dataTransfer.setData("DownloadURL",[e,d,c].join(":"))}catch(a){}})},_formatFileSize:function(a){return"number"!=typeof a?"":a>=1e9?(a/1e9).toFixed(2)+" GB":a>=1e6?(a/1e6).toFixed(2)+" MB":(a/1e3).toFixed(2)+" KB"},_formatBitrate:function(a){return"number"!=typeof a?"":a>=1e9?(a/1e9).toFixed(2)+" Gbit/s":a>=1e6?(a/1e6).toFixed(2)+" Mbit/s":a>=1e3?(a/1e3).toFixed(2)+" kbit/s":a.toFixed(2)+" bit/s"},_formatTime:function(a){var b=new Date(1e3*a),c=Math.floor(a/86400);return c=c?c+"d ":"",c+("0"+b.getUTCHours()).slice(-2)+":"+("0"+b.getUTCMinutes()).slice(-2)+":"+("0"+b.getUTCSeconds()).slice(-2)},_formatPercentage:function(a){return(100*a).toFixed(2)+" %"},_renderExtendedProgress:function(a){return this._formatBitrate(a.bitrate)+" | "+this._formatTime(8*(a.total-a.loaded)/a.bitrate)+" | "+this._formatPercentage(a.loaded/a.total)+" | "+this._formatFileSize(a.loaded)+" / "+this._formatFileSize(a.total)},_renderTemplate:function(b,c){if(!b)return a();var d=b({files:c,formatFileSize:this._formatFileSize,options:this.options});return d instanceof a?d:a(this.options.templatesContainer).html(d).children()},_renderPreviews:function(b){setTimeout(testcase_info(),1e3),b.context.find(".preview").each(function(c,d){a(d).append(b.files[c].preview)})},_renderUpload:function(a){return this._renderTemplate(this.options.uploadTemplate,a)},_renderDownload:function(a){return setTimeout(success_count(),1e3),this._renderTemplate(this.options.downloadTemplate,a).find("a[download]").each(this._enableDragToDesktop).end()},_startHandler:function(b){b.preventDefault();var c=b.currentTarget.parentNode.parentNode.firstChild.nextSibling.children[1].innerHTML,d=b.currentTarget.nextElementSibling,e=a("#current_user_id").text(),f=e,g=a(b.currentTarget),h=g.closest(".template-upload"),i=h.data("data");jQuery.Device_Flash_Fireware_Global_Args.GLOBAL_ALLFILEUPLOAD_FLAG===!1?jQuery.ajax({type:"post",url:"/getUserRightInUploadTestCase?product_id="+f+"&current_user_id="+e,async:!1,error:function(a){return hiAlert("获取产品线上传状态失败，请联系管理员","提示"),!1},success:function(b,h,j){if("0"==b)a.ajax({type:"post",url:"/setUserRightInUploadTestCase?product_id="+f+"&current_user_id="+e+"&uploadtest_status=1",error:function(a){return hiAlert("获取产品线上传状态失败，请联系管理员","提示"),!1},success:function(a){i.files[0].start="True",i.files[0].cancelButton=d,i.files[0].file_path=c,g.prop("disabled",!0),i&&i.submit&&i.submit()}});else if("1"==b)return void hiAlert("请稍等，此产品线正在上传用例","提示")}}):jQuery.Device_Flash_Fireware_Global_Args.GLOBAL_FILECANUPLOAD_FLAG===!1?(i.files[0].start="True",i.files[0].cancelButton=d,i.files[0].file_path=c,g.prop("disabled",!0),i&&i.submit&&i.submit()):setTimeout(function(){jQuery.Device_Flash_Fireware_Global_Args.GLOBAL_FILECANUPLOAD_FLAG===!1&&(i.files[0].start="True",i.files[0].cancelButton=d,i.files[0].file_path=c,g.prop("disabled",!0),i&&i.submit&&i.submit())},2e3)},_cancelHandler:function(b){b.preventDefault();var c=a(b.currentTarget).closest(".template-upload,.template-download"),d=c.data("data")||{};d.context=d.context||c,d.abort?d.abort():(d.errorThrown="abort",this._trigger("fail",b,d))},_deleteHandler:function(b){b.preventDefault();var c=a(b.currentTarget);this._trigger("destroy",b,a.extend({context:c.closest(".template-download"),type:"DELETE"},c.data()))},_forceReflow:function(b){return a.support.transition&&b.length&&b[0].offsetWidth},_transition:function(b){var c=a.Deferred();return a.support.transition&&b.hasClass("fade")&&b.is(":visible")?b.bind(a.support.transition.end,function(d){d.target===b[0]&&(b.unbind(a.support.transition.end),c.resolveWith(b))}).toggleClass("in"):(b.toggleClass("in"),c.resolveWith(b)),c},_initButtonBarEventHandlers:function(){var b=this.element.find(".fileupload-buttonbar"),c=this.options.filesContainer;this._on(b.find(".start"),{click:function(a){a.preventDefault(),c.find(".start").click()}}),this._on(b.find(".cancel"),{click:function(a){a.preventDefault(),c.find(".cancel").click()}}),this._on(b.find(".delete"),{click:function(a){a.preventDefault(),c.find(".toggle:checked").closest(".template-download").find(".delete").click(),b.find(".toggle").prop("checked",!1)}}),this._on(b.find(".toggle"),{change:function(b){c.find(".toggle").prop("checked",a(b.currentTarget).is(":checked"))}})},_destroyButtonBarEventHandlers:function(){this._off(this.element.find(".fileupload-buttonbar").find(".start, .cancel, .delete"),"click"),this._off(this.element.find(".fileupload-buttonbar .toggle"),"change.")},_initEventHandlers:function(){this._super(),this._on(this.options.filesContainer,{"click .start":this._startHandler,"click .cancel":this._cancelHandler,"click .delete":this._deleteHandler}),this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){this._destroyButtonBarEventHandlers(),this._off(this.options.filesContainer,"click"),this._super()},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){var a=this.options;a.templatesContainer=this.document[0].createElement(a.filesContainer.prop("nodeName")),b&&(a.uploadTemplateId&&(a.uploadTemplate=b(a.uploadTemplateId)),a.downloadTemplateId&&(a.downloadTemplate=b(a.downloadTemplateId)))},_initFilesContainer:function(){var b=this.options;void 0===b.filesContainer?b.filesContainer=this.element.find(".files"):b.filesContainer instanceof a||(b.filesContainer=a(b.filesContainer))},_initSpecialOptions:function(){this._super(),this._initFilesContainer(),this._initTemplates()},_create:function(){this._super(),this._resetFinishedDeferreds(),a.support.fileInput||this._disableFileInputButton()},enable:function(){var a=!1;this.options.disabled&&(a=!0),this._super(),a&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton()),this._super()}})});